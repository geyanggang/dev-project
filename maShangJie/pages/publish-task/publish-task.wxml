<!--pages/publish-task/publish-task.wxml-->
<view class="container">
  <view class="publish-form">
    <!-- 任务标题 -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        任务标题
      </view>
      <input class="input" placeholder="请输入任务标题" bindinput="onTitleInput" value="{{formData.title}}" maxlength="50" />
      <view class="hint">{{formData.title.length}}/50</view>
    </view>

    <!-- 任务描述 -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        任务描述
      </view>
      <textarea class="textarea" 
                placeholder="详细描述你的需求，包括功能要求、技术要求等" 
                bindinput="onDescInput"
                value="{{formData.description}}"
                maxlength="1000"
                auto-height />
      <view class="hint">{{formData.description.length}}/1000</view>
    </view>

    <!-- 预算范围 -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        预算范围
      </view>
      <view class="budget-input">
        <input class="input" type="digit" placeholder="最低预算" bindinput="onMinBudgetInput" value="{{formData.budgetRange.min}}" />
        <text class="separator">-</text>
        <input class="input" type="digit" placeholder="最高预算" bindinput="onMaxBudgetInput" value="{{formData.budgetRange.max}}" />
      </view>
    </view>

    <!-- 截止日期 -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        截止日期
      </view>
      <picker mode="date" value="{{formData.deadline}}" start="{{today}}" bindchange="onDeadlineChange">
        <view class="picker">
          {{formData.deadline || '请选择截止日期'}}
        </view>
      </picker>
    </view>

    <!-- 技术栈 -->
    <view class="form-item">
      <view class="label">
        <text class="required">*</text>
        技术栈要求
      </view>
      <view class="tech-selector">
        <view class="tag {{formData.techStack.indexOf(item) > -1 ? 'tag-primary' : ''}}"
              wx:for="{{techOptions}}" 
              wx:key="index"
              bindtap="toggleTech"
              data-tech="{{item}}">
          {{item}}
        </view>
      </view>
      <view class="hint">已选择 {{formData.techStack.length}} 个</view>
    </view>

    <!-- AI评估按钮 -->
    <view class="ai-estimate-section">
      <button class="btn-secondary" bindtap="getAIEstimate" disabled="{{!canEstimate}}">
        <image src="/images/ai.png" mode="aspectFit"></image>
        AI智能评估价格
      </button>
      
      <view class="ai-result" wx:if="{{aiPrice}}">
        <view class="ai-label">AI参考价格</view>
        <view class="ai-price">¥{{aiPrice}}</view>
        <view class="ai-desc">基于任务复杂度和市场行情</view>
      </view>
    </view>

    <!-- 最终定价 -->
    <view class="form-item" wx:if="{{aiPrice}}">
      <view class="label">
        <text class="required">*</text>
        最终定价
      </view>
      <input class="input price-input" 
             type="digit" 
             placeholder="请输入最终价格" 
             bindinput="onFinalPriceInput" 
             value="{{formData.finalPrice}}" />
      <view class="hint">建议参考AI评估价格</view>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-section">
      <button class="btn-primary submit-btn" bindtap="submitTask" disabled="{{submitting}}">
        {{submitting ? '发布中...' : '发布任务'}}
      </button>
    </view>
  </view>
</view>

